services:
  # =========================
  # API GATEWAY (Public)
  # =========================
  - type: web
    name: bx-gateway
    env: python
    region: frankfurt
    plan: free
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn _api:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: MAIN_API
        value: https://bx-core.onrender.com
      - key: WALLET_API
        value: https://bx-wallet.onrender.com
      - key: ADMIN_API
        value: https://bx-admin.onrender.com
      - key: TELEGRAM_BOT_TOKEN
        sync: false

  # =========================
  # CORE SERVICE
  # =========================
  - type: web
    name: bx-core
    env: python
    region: frankfurt
    plan: free
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: TELEGRAM_BOT_TOKEN
        sync: false

  # =========================
  # WALLET SERVICE
  # =========================
  - type: web
    name: bx-wallet
    env: python
    region: frankfurt
    plan: free
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn wallet_api:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: TELEGRAM_BOT_TOKEN
        sync: false

  # =========================
  # ADMIN / REAL MONEY SERVICE
  # =========================
  - type: web
    name: bx-admin
    env: python
    region: frankfurt
    plan: free
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn service_admin:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: ADMIN_TOKEN
        sync: false
      - key: BINANCE_API_KEY
        sync: false
      - key: BINANCE_API_SECRET
        sync: false
      - key: REDOTPAY_API_SECRET
        sync: false
      - key: TON_WALLET
        sync: false

  # =========================
  # TON AUTO DEPOSIT WORKER
  # =========================
  - type: worker
    name: bx-ton-watcher
    env: python
    region: frankfurt
    plan: free
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    startCommand: python ton_watcher.py
    envVars:
      - key: TON_WALLET
        sync: false
