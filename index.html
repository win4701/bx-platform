<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no"/>
<title>Bloxio BX</title>
<script>
if (window.Telegram?.WebApp) { Telegram.WebApp.ready(); Telegram.WebApp.expand(); }
</script>
<style>
:root{
  --bg:#0b0f1a; --panel:#12172a; --panel2:#0f1426;
  --accent:#4ade80; --accent2:#60a5fa; --warn:#facc15;
  --text:#e5e7eb; --muted:#9ca3af;
}
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(180deg,#0b0f1a,#0a0e18);color:var(--text);font-family:system-ui}
#app{max-width:420px;margin:0 auto;padding:14px 14px 120px}
header{padding:10px 4px 16px}
header h1{margin:0;font-size:20px}
.card{
  background:linear-gradient(180deg,var(--panel),var(--panel2));
  border-radius:16px;padding:14px;margin-bottom:12px;
  box-shadow:0 12px 28px rgba(0,0,0,.45)
}
.value{font-size:22px;font-weight:900}
.sub{color:var(--muted);font-size:12px}
.btn{width:100%;padding:12px;border-radius:12px;border:0;font-weight:800;margin-top:8px}
.buy{background:var(--accent);color:#052e16}
.sell{background:var(--accent2);color:#020617}
.nav{
  position:fixed;left:0;right:0;bottom:0;background:#0a0e18;
  border-top:1px solid rgba(255,255,255,.06);
  display:flex;justify-content:space-around;padding:10px 6px
}
.nav button{flex:1;background:none;border:0;color:var(--muted);font-weight:800;padding:8px;border-radius:10px}
.nav button.active{color:var(--accent2);background:rgba(96,165,250,.12)}
.hidden{display:none}
</style>
</head>
<body>
<div id="app">
<header><h1>Bloxio Â· BX</h1></header>

<section class="tab" id="wallet">
  <div class="card">
    <div class="value" id="bx">BX: --</div>
    <div class="sub">Auto mining BX</div>
    <button class="btn buy" onclick="buyBX()">Buy BX (TON)</button>
    <button class="btn sell" onclick="withdrawTON()">Withdraw TON</button>
  </div>
</section>

<section class="tab hidden" id="mining">
  <div class="card">
    <h3>Mining External (xv)</h3>
    <div class="value" id="bnb">BNB: --</div>
    <div class="value" id="sol">SOL: --</div>
    <div class="sub">Auto mining per minute</div>
  </div>
</section>

<section class="tab hidden" id="casino">
  <div class="card">
    <div class="value" id="crash">@ --x</div>
    <div class="value" id="dice">--</div>
    <div class="value" id="chicken">--</div>
  </div>
</section>

</div>

<nav class="nav">
  <button class="active" onclick="showTab('wallet',this)">Wallet</button>
  <button onclick="showTab('mining',this)">Mining</button>
  <button onclick="showTab('casino',this)">Casino</button>
</nav>

<script>
const uid = Telegram.WebApp?.initDataUnsafe?.user?.id || 1;

function showTab(id,el){
  document.querySelectorAll('.tab').forEach(t=>t.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
}

async function buyBX(){
  const ton = prompt("TON amount");
  if(!ton) return;
  await fetch('/buy/ton',{method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({user:uid,ton:parseFloat(ton)})});
}

async function withdrawTON(){
  const ton = prompt("TON amount");
  const addr = prompt("TON address");
  if(!ton||!addr) return;
  await fetch('/withdraw/ton',{method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({user:uid,ton:parseFloat(ton),address:addr})});
}

async function tick(){
  try{
    let r,d;
    r = await fetch(`/wallet/${uid}`); d = await r.json(); bx.textContent = `BX: ${d.bx}`;
    r = await fetch(`/mining/bnb/${uid}`); d = await r.json(); bnb.textContent = `BNB: ${d.balance}`;
    r = await fetch(`/mining/sol/${uid}`); d = await r.json(); sol.textContent = `SOL: ${d.balance}`;
    r = await fetch(`/casino/crash?uid=${uid}`); d = await r.json(); crash.textContent = `@ ${d.crash_at}x`;
    r = await fetch(`/casino/dice?uid=${uid}`); d = await r.json(); dice.textContent = d.roll ?? '--';
    r = await fetch(`/casino/chicken?uid=${uid}&step=3`); d = await r.json(); chicken.textContent = d.result ?? '--';
  }catch(e){}
}
setInterval(tick,1500);
tick();
</script>
</body>
</html>
