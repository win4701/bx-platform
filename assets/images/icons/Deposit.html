<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bloxio BX</title>

<style>
/* ================= THEME ================= */
:root{
  --bg:#0b0f14;
  --panel:#121820;
  --border:#1f2a3a;
  --green:#39d98a;
  --green-soft:#6affb1;
  --yellow:#f1c40f;
  --text:#eaeaea;
  --muted:#9aa4b2;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Arial;
  background:var(--bg);
  color:var(--text);
  display:flex;
  flex-direction:column;
  height:100vh;
}

/* ================= HEADER ================= */
header{
  padding:14px;
  text-align:center;
  background:#0e141c;
  font-weight:600;
  font-size:18px;
}

/* ================= MAIN ================= */
main{
  flex:1;
  padding:16px;
  overflow-y:auto;
}

/* ================= SECTIONS ================= */
.section{display:none}
.section.active{display:block}

/* ================= CARDS ================= */
.card{
  background:linear-gradient(180deg,#121f1a,#0e1814);
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
}

h3{
  margin:0 0 12px;
  font-size:16px;
}

/* ================= WALLET ================= */
.wallet-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin:8px 0;
}
.wallet-row img{width:26px}

/* ================= FORMS ================= */
button,input,select{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid #2a3445;
  background:#1a2230;
  color:#fff;
  margin-top:8px;
}

button{
  border:none;
  background:linear-gradient(135deg,var(--green),var(--green-soft));
  color:#00140a;
  font-weight:700;
}
button.secondary{background:#3498db;color:#fff}
button.warn{
  background:linear-gradient(135deg,#f7d774,#f1c40f);
  color:#2b1d00;
}

/* ================= MARKET ================= */
.switch{
  display:flex;
  background:#0d1612;
  border-radius:12px;
  padding:4px;
  margin:12px 0;
}
.switch button{
  flex:1;
  background:none;
  color:var(--muted);
}
.switch button.active{
  background:linear-gradient(135deg,var(--green),var(--green-soft));
  color:#00140a;
}

.sell-limit{
  margin-top:12px;
}
.sell-limit .bar{
  height:6px;
  background:#0d1612;
  border-radius:6px;
  overflow:hidden;
}
.sell-limit .used{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#f1c40f,#e67e22);
}

/* ================= NAV ================= */
nav{
  display:flex;
  justify-content:space-around;
  align-items:center;
  padding:10px 0;
  background:#0e141c;
  border-top:1px solid var(--border);
}
nav .item{
  display:flex;
  flex-direction:column;
  align-items:center;
  font-size:12px;
  color:#aaa;
  cursor:pointer;
}
nav .item.active{color:var(--green)}
nav img{width:22px;margin-bottom:4px}
</style>
</head>

<body>

<!-- ================= HEADER ================= -->
<header>Bloxio BX</header>

<!-- ================= MAIN ================= -->
<main>

  <!-- ===== HOME / WALLET ===== -->
  <section id="home" class="section active">

    <!-- Balances -->
    <div class="card">
      <h3>Wallet</h3>
      <div class="wallet-row"><img src="assets/images/icons/bx.png"> BX <span id="bx">0</span></div>
      <div class="wallet-row"><img src="assets/images/icons/ton.png"> TON <span id="ton">0</span></div>
      <div class="wallet-row"><img src="assets/images/icons/usdt.png"> USDT <span id="usdt">0</span></div>
    </div>

    <!-- Deposit -->
    <div class="card">
      <h3>Deposit</h3>
      <button onclick="deposit('binance')">Binance</button>
      <button onclick="deposit('redotpay')">RedotPay</button>
      <button onclick="deposit('ton')">TON Transfer</button>
    </div>

    <!-- Withdraw -->
    <div class="card">
      <h3>Withdraw</h3>
      <input id="withdrawAddress" placeholder="Address / Pay ID">
      <input id="withdrawAmount" type="number" placeholder="Amount">
      <select id="withdrawAsset">
        <option value="ton">TON</option>
        <option value="usdt">USDT</option>
      </select>
      <button class="warn" onclick="withdraw()">Withdraw</button>
    </div>

  </section>

  <!-- ===== MARKET ===== -->
  <section id="market" class="section">

    <div class="card">
      <h3>Market</h3>

      <div class="switch">
        <button id="btn-buy" class="active" onclick="setSide('buy')">Buy</button>
        <button id="btn-sell" onclick="setSide('sell')">Sell</button>
      </div>

      <input id="amountInput" type="number" placeholder="BX amount">

      <div class="wallet-row">
        <span>Total</span>
        <strong id="total">0.00</strong>
      </div>

      <div class="sell-limit">
        <div class="bar"><div class="used" id="sellUsed"></div></div>
        <small>Sell limit: 20%</small>
      </div>

      <button onclick="confirmMarket()">Confirm</button>
    </div>

  </section>

</main>

<!-- ================= NAV ================= -->
<nav>
  <div class="item active" onclick="show('home',this)">
    <img src="assets/images/icons/home.png">Home
  </div>
  <div class="item" onclick="show('market',this)">
    <img src="assets/images/icons/market.png">Market
  </div>
</nav>

<!-- ================= SCRIPT ================= -->
<script>
/* ===== CONFIG ===== */
const uid = 1;
const price = 0.955489564;
let side = "buy";

/* ===== NAV ===== */
function show(id,el){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('nav .item').forEach(i=>i.classList.remove('active'));
  el.classList.add('active');
}

/* ===== LOAD WALLET ===== */
async function loadState(){
  const r = await fetch(`/state?uid=${uid}`);
  const d = await r.json();
  bx.textContent = d.bx;
  ton.textContent = d.ton;
  usdt.textContent = d.usdt;
}
loadState();

/* ===== MARKET ===== */
function setSide(s){
  side = s;
  btn-buy.classList.toggle("active", s==="buy");
  btn-sell.classList.toggle("active", s==="sell");
}

amountInput.oninput = ()=>{
  total.textContent = (amountInput.value * price).toFixed(4);
};

async function confirmMarket(){
  await fetch(`/market/${side}`,{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      uid,
      amount:Number(amountInput.value),
      against:"ton"
    })
  });
  loadState();
}

/* ===== DEPOSIT ===== */
async function deposit(provider){
  await fetch("/wallet/deposit",{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      uid,
      provider,
      amount:10
    })
  });
}

/* ===== WITHDRAW ===== */
async function withdraw(){
  await fetch("/wallet/withdraw",{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      uid,
      asset:withdrawAsset.value,
      amount:Number(withdrawAmount.value),
      address:withdrawAddress.value
    })
  });
  loadState();
}

/* ===== SELL LIMIT VISUAL ===== */
sellUsed.style.width = "12%";
</script>

</body>
</html>
